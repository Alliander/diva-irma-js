const { expect } = require('chai');

const { signatureUnquoteNumberValues, signatureFromToken } = require('./diva-irma');

describe('Diva IRMA', () => {
  const token = 'eyJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJhYnNfcmVzdWx0Iiwic2lnbmF0dXJlIjp7InYiOjEsInNpZ25hdHVyZSI6W3siYyI6MzY3MDIwNjY1NjA1MTYzNzI1NjkwMzIwNzIwMjQ1NTgxNTI5MzY2NTM0MTU4NDA0MjQwNTc4Mjc5Nzk0ODc5NTE5Mjk1NTczMTA2ODUsIkEiOjM3MDcyOTg3MzUzMTAxOTIxMTA1NDEwOTE4ODg1MDMyMzA1MDAxNDcyOTk2OTg4NjI3MTk3OTY0MDE3NTQ5Mzc0Mjc5NTI4ODMwNTkwNDExNzgyMDE0NTI5MjYzODM4MjMzNTMwOTQwMTEzOTQwNTgzNzYyODI0MzYzODk3MTkxMTQ5MjY5OTkzMDAyNjQ1NjA2ODY3OTE2NzM3NTgzOTc2NDI3NjAyOTY4MTA2NjA4NDI5ODIyNjEzNjgwMzg4NjU4NTY0OTE4NDg1MjkwMjMzMDY5OTk3MjU4MjgzMTYzNDIwMjUxMzkyMTY2MTYwOTQzMDczMTE1MzMzMjE2MjcxNjMzNDc5MzUxMDY5Mzg3NjE1MTg5NDU0MjY1NjY3NjQ1ODYzNzE3OTMyMzY2NDQ2ODU2NDcwMTcxMjAyODc5MTM1MzE3NDM5NTg4OTcwOTI3MzM5ODYwODM2MDQyNTM2NzYxNDc5NTQ1OTM4Njk2OTQxMzM5NjY5MTI0NTA2NTQ5MDA1MzQzNDU3ODczNjg5NjkxNDMxNjQ3NDM1NzQ0MTkyNDM1MTIwMzc3NzE5MzEzMDg2NjM4NzYwMzgzNjI5MTA5NDkwMDIyNTY5OTk3MzQxNDAzMzgwMDEzNzM0Mjg2NTAzNzIyNjM3NDk2NzIxMTgwNzUzOTYzNTA0MjI2ODU4NzI5NDIwOTc3NDIxMzYzNTA2MDIyNDUxNDkwNzk4MTgwMDE0NTY4Nzg4NDM2NTE5MDkyODc5NjAzMDk2OTc1NTU2OTI3MzUyODI2NDIxODg1MzI5NDYxNzY4Njk2OTI4NzA3NTcsImVfcmVzcG9uc2UiOjgxOTg4NzA3MjQwMTEyMTM3NjE1MjQzMTM2OTczNTI0NTA2NTY0Njg2ODI4NzExNDg4MDE0NjgwOTA0MDMwMjk1MDAwNzg3MjIxMTMxNjU1ODI3NTY3MDY5ODkxMjA2OTA1NDUzODc3OTI2NzgwNjgzNTc3Mjg4MzE4MjgyMDYxMDAzNDQyMDk1MzkyMTgyMjc3MjYxNDgsInZfcmVzcG9uc2UiOi01Njk0Mzg5Mjc5NTM1OTQ5MjU5NjAyMDQxOTk5OTg0NjA5OTA0NjUxMTU5NDQ3MjYzMDAxODgzNzgzOTMxNjQ5NjAxNDM0NTYzNDk5OTUyNzEwNzg5NjAwOTk1MTA3NjAzNzc2Nzk0NzgyNDYzNjAyNDYyMzI2NzI2MDY0MDEzMDYxNDIyNzAzNjYxMjk3NzM4Mjk3NzA1ODc1NjMzNDg2MDAxMzQ0MjUxMzM0MzYzNDc4OTQ3OTU5NjE4OTU4NzEwNjg3MDg0NTM1MjQ0NzMxNDA3MDI3MDIzMTI0NDU3MjM4OTg2NzMxMjQ2ODgwMTEyMTc2NjU1OTg4MDk5NDU5NzUwNzcwMjM3MDgyNDI5NTQzMTQ0NDA0MDU0MzUzODI2NDQ1NDE3MjU5Mzc0NDM3ODk5NDg1Mjk1NTA4MTMwODA4NTk3NjI3ODU0MTQwMzUzMzE0NDc3ODk5NTAyNTU1NzEwMjE1OTY5MTA3ODA3NDE2OTA0OTkxNzQwODc5NzEwMTg5OTQzNTQxNTMzNDczOTQ5ODI2NzcxODAxMDYxNDQxODYwMjM0MTY5MjA5NzExMTEzMzQwMDg4NTQzMjE5MDQ4NDQ2OTMwNTM0MzE1NzgwMDk2MjA4NDc2MzY5NTY3ODI5NTI3MDU1NjcyNTEzOTU3MjU0ODA4NDAyMzI0NDYwODA0MDA1MTE4ODM4NjUyMjM1NzgwNDIxMzAwNDg2NDQ2MjI0MDcxMTkxNTg4MTMxMDMxNzAyNTA3Mzc2NjcxNTI2NTk3Mjk0Njk5NzY2NDE2MzAwNTIwODk2NTkxMTkyNDY3ODU3NzE0OTEyNDU3NDMyODI2NDMwMDc1MDczNTcwNzE3MTg1MTk4MzQ3NjUyNjczOTk4NDAwNzMwOTA5NDMxMzAzMTE2MDEyMjQ3MDgwODIwODM4Mzk5MTMzNDk0NzY1OTYyMzE0MjU4ODUyOTEzNjAzMzI2MjM4NjMwMjc5MDI0MzkyMzE4MTUzNjE5ODM2MjgxOTQ1NTEzOTUzMzQ5NjMyOTIwMDU1MDU5OTE1OTYxOTA2NTk0Nzc0NDM2MzQ5ODc4MjgxMjYyNjA0NzkzOTc0ODcwMTQyNTc0Mzc5NTI2MTE5MzM2ODI3ODI2MTAyNjI5NDE1OTAxMzQ3MDg3MzE3NDk4MzAzOTY2OTAyNzE2MzY2NjAxNTk0ODc3NTc0ODYxMDE1NDkyNTQ4NTkyNDM4NzI2OTU0LCJhX3Jlc3BvbnNlcyI6eyIwIjoxNTEwMjk3NjUwODUzMDI2NzAzMjA5MTc1MjUwNDYzNDk1NDIwOTMwNzM2OTUzMzQ4MDgwMjkzMDkyNjA4ODkyMDAzNDY1OTIwNjIyNzU3NzcwNTYxODUyNDYwMzcyMjA0MzkxOTkwNTUyOTc4MTQzNTc0NjIwNTk3NTYwNTEyODUxMjk2ODg5MjczOTk2NDIzNDQ2NTE4MDQ4MDIyNzU1NTg1OTI0MTQ2Mjc4Mjg5MjA3NCwiMiI6MjI5NTE3MjI2ODA1MzU3NTI2MDYyMzc0MDQ4MTU0MzU3OTA5MTM4MjU0NjcyMjY3MzExODg0NTI5MjgyMjk0MjUwNDE3NTI5MTg2MTAyMjkwMDc5MDUzNDcxMTc5OTU2ODkxNDc4OTE4Mjg3OTY4MTExNzY3MjE3MTE2MjA2MDM2OTc3MjA5ODAyNjczNDUwMjA3NDUzOTc3MjcxNjkzMDMzMzEzMzU5MzQwNDc2NDQ5OTY2NjQ4Njg2MTAzMjI4NywiMyI6MTI5MzYxODM1NTE5MDE5MDM4NDU3ODgyODQxMDg2OTUxNDAzNTkwMjUxMDU1MzQ5MjY3MDI2MDUxOTQxNDM4MTMzMDIyNjM0OTgzMjk5NDMyMDM2NzgwMzYyNDEwMzYwNjAyMDgzODM0MDg5MTEyODczMDUyNjQxMjYzMDkyMjUyMTcyMDQ2Mzg1NDQ0NDM3NjY5OTgwMzY0MjU1NDY0NzU2NzIwODEwMDQ2NTYwMTUyMjc0MTk1NzQxOTUwNzMyM30sImFfZGlzY2xvc2VkIjp7IjEiOjczNTYzNDgwNjM4MzAzOTU4MDMyOTg0NTE4MDEwMzk2OTcxNzc4OTUwNDkzMDA5MzMwNjgxNDk0LCI0IjozNDg3MjAyODg1OTEyNzY5MDU0MTAyMzcwMDY4MDExNjY3Mjk0MjQ3MTI2MzM3NDI1MTN9fV0sIm5vbmNlIjoyNTE3OTQ5MjIyOTU2ODI0NDI0NTQ4ODgzNTgxMDE4NTg3OTIyOTcsImNvbnRleHQiOjc5ODQzOTY0NzgyNTQ1MTIyMzY3MjI4NTI2NzQzODEzMDc3MTM2NTcwMDc1MTc5OTA3Njc4MjI3NjgxOTEwMDA4NjcwMzg1NTQzMzI1LCJtZXNzYWdlIjoiR2Fzd2F0dCBtYWcgUDQtZGF0YSBvcHZyYWdlbiBiaWogRURTTiB6b2RhdCB6ZSBlZW4gZ29lZGUgZW5lcmdpZXZlcmdlbGlqa2luZyBrdW5uZW4gbWFrZW4uIn0sImlzcyI6ImlybWFfYXBpX3NlcnZlciIsImF0dHJpYnV0ZXMiOnsiaXJtYS1kZW1vLmFsbGlhbmRlci5jb25uZWN0aW9uLnBzZXVkb255bSI6IndNU0cyNGpjRjVqT0dLc1pfQTJ6WCIsImlybWEtZGVtby5hbGxpYW5kZXIuY29ubmVjdGlvbiI6InByZXNlbnQifSwiZXhwIjoxNTMwNzA1OTU5LCJpYXQiOjE1MzA3MDU4OTksInN0YXR1cyI6IlZBTElEIn0.hnyoWgPaD2OS-0zp0KSSKvcF2xREpTeOuNs2a2OZ663m_VRbBSWulDcASCFTJ0fKpZeMeok89DzZh-jH-PL6tbnAPndTHp_GBDgnWQ8U1ZfQLFCWI2l8vhK0p7TjqLWJ5I5C9Ec3oPf3hoRRfhBwg4_rBoZJYdrvShu37xIfNK4SpsKJQdbfPSRaBtfYH-nKkpe0LPsfDw5KmxvfKURtrecv95td3UX-8xxeidTt4IgHL07Ry_RwAgmqwDzkYAnaus9hTSp1vFImJpQFS3vImhHcFWgyiiM4EGrPIPAR-NG2GovuOc1iVIRMI9Tw-XH7WEGNK9sCIxi8euOQrG6WWQ';
  const quotedSignature = '{"v":"1","signature":[{"c":"36702066560516372569032072024558152936653415840424057827979487951929557310685","A":"3707298735310192110541091888503230500147299698862719796401754937427952883059041178201452926383823353094011394058376282436389719114926999300264560686791673758397642760296810660842982261368038865856491848529023306999725828316342025139216616094307311533321627163347935106938761518945426566764586371793236644685647017120287913531743958897092733986083604253676147954593869694133966912450654900534345787368969143164743574419243512037771931308663876038362910949002256999734140338001373428650372263749672118075396350422685872942097742136350602245149079818001456878843651909287960309697555692735282642188532946176869692870757","e_response":"8198870724011213761524313697352450656468682871148801468090403029500078722113165582756706989120690545387792678068357728831828206100344209539218227726148","v_response":"-5694389279535949259602041999984609904651159447263001883783931649601434563499952710789600995107603776794782463602462326726064013061422703661297738297705875633486001344251334363478947959618958710687084535244731407027023124457238986731246880112176655988099459750770237082429543144404054353826445417259374437899485295508130808597627854140353314477899502555710215969107807416904991740879710189943541533473949826771801061441860234169209711113340088543219048446930534315780096208476369567829527055672513957254808402324460804005118838652235780421300486446224071191588131031702507376671526597294699766416300520896591192467857714912457432826430075073570717185198347652673998400730909431303116012247080820838399133494765962314258852913603326238630279024392318153619836281945513953349632920055059915961906594774436349878281262604793974870142574379526119336827826102629415901347087317498303966902716366601594877574861015492548592438726954","a_responses":{"0":"15102976508530267032091752504634954209307369533480802930926088920034659206227577705618524603722043919905529781435746205975605128512968892739964234465180480227555859241462782892074","2":"2295172268053575260623740481543579091382546722673118845292822942504175291861022900790534711799568914789182879681117672171162060369772098026734502074539772716930333133593404764499666486861032287","3":"1293618355190190384578828410869514035902510553492670260519414381330226349832994320367803624103606020838340891128730526412630922521720463854444376699803642554647567208100465601522741957419507323"},"a_disclosed":{"1":"73563480638303958032984518010396971778950493009330681494","4":"348720288591276905410237006801166729424712633742513"}}],"nonce":"251794922295682442454888358101858792297","context":"79843964782545122367228526743813077136570075179907678227681910008670385543325","message":"Gaswatt mag P4-data opvragen bij EDSN zodat ze een goede energievergelijking kunnen maken."}';
  const unquotedSignature = '{"v":"1","signature":[{"c":36702066560516372569032072024558152936653415840424057827979487951929557310685,"A":3707298735310192110541091888503230500147299698862719796401754937427952883059041178201452926383823353094011394058376282436389719114926999300264560686791673758397642760296810660842982261368038865856491848529023306999725828316342025139216616094307311533321627163347935106938761518945426566764586371793236644685647017120287913531743958897092733986083604253676147954593869694133966912450654900534345787368969143164743574419243512037771931308663876038362910949002256999734140338001373428650372263749672118075396350422685872942097742136350602245149079818001456878843651909287960309697555692735282642188532946176869692870757,"e_response":8198870724011213761524313697352450656468682871148801468090403029500078722113165582756706989120690545387792678068357728831828206100344209539218227726148,"v_response":-5694389279535949259602041999984609904651159447263001883783931649601434563499952710789600995107603776794782463602462326726064013061422703661297738297705875633486001344251334363478947959618958710687084535244731407027023124457238986731246880112176655988099459750770237082429543144404054353826445417259374437899485295508130808597627854140353314477899502555710215969107807416904991740879710189943541533473949826771801061441860234169209711113340088543219048446930534315780096208476369567829527055672513957254808402324460804005118838652235780421300486446224071191588131031702507376671526597294699766416300520896591192467857714912457432826430075073570717185198347652673998400730909431303116012247080820838399133494765962314258852913603326238630279024392318153619836281945513953349632920055059915961906594774436349878281262604793974870142574379526119336827826102629415901347087317498303966902716366601594877574861015492548592438726954,"a_responses":{"0":15102976508530267032091752504634954209307369533480802930926088920034659206227577705618524603722043919905529781435746205975605128512968892739964234465180480227555859241462782892074,"2":2295172268053575260623740481543579091382546722673118845292822942504175291861022900790534711799568914789182879681117672171162060369772098026734502074539772716930333133593404764499666486861032287,"3":1293618355190190384578828410869514035902510553492670260519414381330226349832994320367803624103606020838340891128730526412630922521720463854444376699803642554647567208100465601522741957419507323},"a_disclosed":{"1":73563480638303958032984518010396971778950493009330681494,"4":348720288591276905410237006801166729424712633742513}}],"nonce":251794922295682442454888358101858792297,"context":79843964782545122367228526743813077136570075179907678227681910008670385543325,"message":"Gaswatt mag P4-data opvragen bij EDSN zodat ze een goede energievergelijking kunnen maken."}';

  it('should parse the JWT without overflowing', () => {
    const parsed = signatureFromToken(token);

    expect(parsed).to.be.a('string');
    expect(parsed).to.equal(unquotedSignature);
  });

  it('should unquote number values', () => {
    const result = signatureUnquoteNumberValues(quotedSignature);

    expect(result).to.equal(unquotedSignature);
  });
});
